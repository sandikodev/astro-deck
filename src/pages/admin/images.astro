---
// Image Optimizer
---
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex, nofollow" />
  <title>Image Optimizer - Admin Hub</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: Inter, system-ui, sans-serif;
      background: #0a0a0a;
      color: #fafafa;
      min-height: 100vh;
      padding: 2rem;
    }
    .container { max-width: 700px; margin: 0 auto; }
    .back { color: #737373; text-decoration: none; font-size: 0.875rem; }
    .back:hover { color: #fafafa; }
    h1 { font-size: 1.5rem; margin: 1rem 0 0.5rem; }
    .subtitle { color: #737373; margin-bottom: 2rem; font-size: 0.875rem; }
    
    .dropzone {
      border: 2px dashed #262626;
      border-radius: 12px;
      padding: 3rem 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.15s;
      margin-bottom: 1.5rem;
    }
    .dropzone:hover, .dropzone.dragover {
      border-color: #525252;
      background: #1a1a1a;
    }
    .dropzone-icon { font-size: 3rem; margin-bottom: 1rem; }
    .dropzone-text { color: #737373; margin-bottom: 0.5rem; }
    .dropzone-hint { font-size: 0.75rem; color: #525252; }
    
    input[type="file"] { display: none; }
    
    .options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .option { background: #1a1a1a; padding: 1rem; border-radius: 8px; }
    .option label { display: block; font-size: 0.875rem; color: #a3a3a3; margin-bottom: 0.5rem; }
    .option select, .option input {
      width: 100%;
      padding: 0.5rem;
      background: #0a0a0a;
      border: 1px solid #262626;
      border-radius: 6px;
      color: #fafafa;
      font-size: 0.875rem;
    }
    
    .results { display: none; }
    .results.show { display: block; }
    .result-card {
      background: #1a1a1a;
      border: 1px solid #262626;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1rem;
    }
    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    .result-name { font-weight: 600; word-break: break-all; }
    .result-savings {
      background: #22c55e20;
      color: #22c55e;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.875rem;
    }
    .result-preview {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .preview-box { text-align: center; }
    .preview-box img {
      max-width: 100%;
      max-height: 150px;
      border-radius: 8px;
      margin-bottom: 0.5rem;
    }
    .preview-label { font-size: 0.75rem; color: #737373; }
    .preview-size { font-size: 0.875rem; }
    
    .btn {
      display: inline-block;
      padding: 0.75rem 1.5rem;
      background: #fafafa;
      color: #0a0a0a;
      border: none;
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
    }
    .btn:hover { opacity: 0.9; }
    .btn-secondary { background: #262626; color: #fafafa; }
    
    .processing {
      display: none;
      text-align: center;
      padding: 2rem;
      color: #737373;
    }
    .processing.show { display: block; }
    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #262626;
      border-top-color: #fafafa;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="container">
    <a href="/admin" class="back">‚Üê Back to Admin Hub</a>
    <h1>Image Optimizer</h1>
    <p class="subtitle">Compress images for better performance (client-side, no upload)</p>
    
    <div class="dropzone" id="dropzone">
      <div class="dropzone-icon">üñºÔ∏è</div>
      <div class="dropzone-text">Drop images here or click to select</div>
      <div class="dropzone-hint">Supports JPG, PNG, WebP ‚Ä¢ Max 10MB per file</div>
      <input type="file" id="fileInput" accept="image/jpeg,image/png,image/webp" multiple />
    </div>
    
    <div class="options">
      <div class="option">
        <label>Output Format</label>
        <select id="format">
          <option value="webp">WebP (recommended)</option>
          <option value="jpeg">JPEG</option>
          <option value="png">PNG</option>
        </select>
      </div>
      <div class="option">
        <label>Quality (1-100)</label>
        <input type="number" id="quality" value="80" min="1" max="100" />
      </div>
      <div class="option">
        <label>Max Width (px)</label>
        <input type="number" id="maxWidth" value="1200" min="100" max="4000" />
      </div>
      <div class="option">
        <label>Max Height (px)</label>
        <input type="number" id="maxHeight" value="630" min="100" max="4000" />
      </div>
    </div>
    
    <div class="processing" id="processing">
      <div class="spinner"></div>
      <div>Processing images...</div>
    </div>
    
    <div class="results" id="results"></div>
  </div>
  
  <script>
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const processing = document.getElementById('processing');
    const results = document.getElementById('results');
    
    dropzone.addEventListener('click', () => fileInput.click());
    dropzone.addEventListener('dragover', (e) => { e.preventDefault(); dropzone.classList.add('dragover'); });
    dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
    dropzone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropzone.classList.remove('dragover');
      handleFiles(e.dataTransfer.files);
    });
    fileInput.addEventListener('change', (e) => handleFiles(e.target.files));
    
    async function handleFiles(files) {
      if (!files.length) return;
      
      processing.classList.add('show');
      results.classList.remove('show');
      results.innerHTML = '';
      
      const format = document.getElementById('format').value;
      const quality = parseInt(document.getElementById('quality').value) / 100;
      const maxWidth = parseInt(document.getElementById('maxWidth').value);
      const maxHeight = parseInt(document.getElementById('maxHeight').value);
      
      for (const file of files) {
        try {
          const result = await compressImage(file, { format, quality, maxWidth, maxHeight });
          addResult(file, result);
        } catch (err) {
          console.error(err);
        }
      }
      
      processing.classList.remove('show');
      results.classList.add('show');
    }
    
    function compressImage(file, opts) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => {
          let { width, height } = img;
          
          // Resize if needed
          if (width > opts.maxWidth || height > opts.maxHeight) {
            const ratio = Math.min(opts.maxWidth / width, opts.maxHeight / height);
            width = Math.round(width * ratio);
            height = Math.round(height * ratio);
          }
          
          const canvas = document.createElement('canvas');
          canvas.width = width;
          canvas.height = height;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0, width, height);
          
          const mimeType = opts.format === 'webp' ? 'image/webp' : 
                          opts.format === 'png' ? 'image/png' : 'image/jpeg';
          
          canvas.toBlob((blob) => {
            resolve({
              blob,
              width,
              height,
              url: URL.createObjectURL(blob),
              format: opts.format
            });
          }, mimeType, opts.quality);
        };
        img.onerror = reject;
        img.src = URL.createObjectURL(file);
      });
    }
    
    function formatSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
    }
    
    function addResult(original, compressed) {
      const savings = ((1 - compressed.blob.size / original.size) * 100).toFixed(0);
      const originalUrl = URL.createObjectURL(original);
      const newName = original.name.replace(/\.[^.]+$/, '.' + compressed.format);
      
      const card = document.createElement('div');
      card.className = 'result-card';
      card.innerHTML = `
        <div class="result-header">
          <span class="result-name">${newName}</span>
          <span class="result-savings">-${savings}%</span>
        </div>
        <div class="result-preview">
          <div class="preview-box">
            <img src="${originalUrl}" alt="Original" />
            <div class="preview-label">Original</div>
            <div class="preview-size">${formatSize(original.size)}</div>
          </div>
          <div class="preview-box">
            <img src="${compressed.url}" alt="Compressed" />
            <div class="preview-label">Compressed (${compressed.width}√ó${compressed.height})</div>
            <div class="preview-size">${formatSize(compressed.blob.size)}</div>
          </div>
        </div>
        <a class="btn" href="${compressed.url}" download="${newName}">Download</a>
      `;
      results.appendChild(card);
    }
  </script>
</body>
</html>
